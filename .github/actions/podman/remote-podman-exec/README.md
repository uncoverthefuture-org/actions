# remote-podman-exec

Run an inline script on a remote host over SSH with a `run_podman` helper function injected. Optionally source an env file before execution.

## Inputs
- `ssh_host`, `ssh_user`, `ssh_key`, `root_ssh_key?`, `ssh_port?`, `ssh_fingerprint?`
- `podman_user?` (default `deployer`), `connect_mode?` (`auto|root|user`)
- `env_file_path?`, `env_name?`, `source_env?=false`, `fail_if_env_missing?=true`
- `inline_script` (required)

## Notes
- When `source_env=true`, pass `env_file_path` and `env_name` so the action can create and source `<env_file_path>/<env_name>/.env`.
- When `fail_if_env_missing=true` (default), the workflow fails if the resolved env file is absent on the remote host.
- **New behavior**: The action now automatically creates the environment directory structure and a default `.env` file with a disclaimer comment if they don't exist.

## Environment files on the remote host

- `env_file_path` should point to the base directory on the remote host where environment files will be stored. When omitted, the calling action will usually derive something like `/var/deployments/<repo-slug>`.
- The action creates a subdirectory named after `env_name` under `env_file_path`, and within that creates a `.env` file. For example, `env_file_path: /var/deployments` with `env_name: dev` creates `/var/deployments/dev/<repo-slug>/.env`.
- If the `.env` file doesn't exist, the action automatically creates it with a comment indicating it's generated by the action. You can populate it manually or use `write-remote-env-file`.
- If you intentionally want to skip sourcing when the file is missing, set `fail_if_env_missing: false`. The action will log a warning and continue.

### Example: ensure env file exists, then run command

```yaml
jobs:
  prepare-and-run:
    runs-on: ubuntu-latest
    steps:
      - uses: uncoverthefuture-org/actions/.github/actions/write-remote-env-file@master
        with:
          ssh_host: ${{ secrets.SSH_HOST }}
          ssh_user: ${{ secrets.SSH_USER }}
          ssh_key: ${{ secrets.SSH_KEY }}
          env_name: dev
          env_b64: ${{ secrets.DEV_ENV_B64 }}

      - uses: uncoverthefuture-org/actions/.github/actions/podman/remote-podman-exec@master
        with:
          ssh_host: ${{ secrets.SSH_HOST }}
          ssh_user: ${{ secrets.SSH_USER }}
          ssh_key: ${{ secrets.SSH_KEY }}
          env_name: dev
          source_env: true
          inline_script: |
            run_podman ps -a
```

## Example (direct)
```yaml
- uses: uncoverthefuture-org/actions/.github/actions/podman/remote-podman-exec@master
  with:
    ssh_host: ${{ secrets.SSH_HOST }}
    ssh_user: ${{ secrets.SSH_USER }}
    ssh_key:  ${{ secrets.SSH_KEY }}
    podman_user: deployer
    inline_script: |
      run_podman ps -a
```
